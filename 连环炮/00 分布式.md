## 分布式

- **系统为什么要拆分，怎么拆分**

  系统没拆分前，很多人维护一套代码，代码经常改着改着就冲突了，然后就合并，比较麻烦耗时间；改动了一个功能，如果有其他地方调用，其他代码也需要跟着重新测试；发布的时候，整个一起打包，还要各个地方功能还需检查。有时候想用新的技术也没法用，怕影响功能。代码耦合度比较高，不易维护

  拆分了之后，自己维护自己的代码，不存在代码冲突，开发效率大大提高

  按模块功能去拆分的，一般1个服务由1-2个人去维护，代码量在1-2W行左右，当一个服务功能变多，参与的人也多了，我们可以继续进行拆分

- **项目中用的是什么分布式服务框架？**

  dubbo  java 语言开发，文档详细，社区活跃，和spring集成，功能全面，有管理中心

  grpc 支持跨语言，没有服务治理，不支持多种注册中心，没有管理中心

  thrift 高性能，没有服务治理，不支持多种注册中心，没有管理中心

- **dubbo工作原理是什么？注册中心挂了可以继续通信吗？**

  服务层，配置层，服务代理层，服务注册层，集群层，监控层，远程调用层，信息交换层，网络传输层，数据序列化层

  provider向注册中心注册

  consumer向注册中心订阅服务，注册中心会通知consumer注册好的服务

  consumer调用provider

  consumer和provider都会异步的通知监控中心

  consumer会缓存服务地址，注册中心挂了可以继续通信

- **dubbo支持哪些序列化协议？**

  通信协议：dubbo协议，rmi协议，hessian协议，http协议

- **dubbo的负载均衡策略和高可用策略都有哪些，动态代理策略呢？**

  使用分配权重在provider上，根据机器性能来调试权重大小

  均匀分配到每个provider

  基于hash的一致性算法，相同参数的请求一定分发到一个provider上去，provider挂掉后，会基于虚拟节点均匀分配剩余流量

  集群容错策略：

  > failover cluster模式，provider在宕机重试后，请求会分发到其他provider，失败自动切换
  >
  > failback 定时重试
  >
  > forking 并行调用多个provider，只要有一个成功就立即返回
  >
  > failfast 一次调用失败就立即失败，常见于写操作
  >
  > failsafe 出现异常时忽略掉，常用于不重要的接口调用

- **dubbo的SPI思想是什么？**

  服务发现机制，将接口的实现类全限定名配置在文件中，并由服务器加载读取配置文件，加载实现类。

  这样可以在运行时，动态为接口替换实现类

- **项目中是如何基于dubbo进行服务治理，服务降级，失败重试以及超时重试？**

  治理：调用链路，服务访问压力，时长统计，监控

  降级：基于mock实现降级措施

  重试：超时重试或者失败重试

- **分布式服务接口的幂等性如何设计（比如不能重复扣款）？**

  每个请求有一个唯一标识，每次处理完必须有一个记录标识记录这个请求处理过，每次接收请求需要进行判断是否已经处理过

- **分布式服务接口请求的顺序性如何保证？**

  通过一致性hash算法分发同类型的请求到同一台服务器，如果内部处理是多线程处理的

- **如何自己设计一个类似dubbo的rpc框架？**

  



- **分布式锁有用过吗，redis分布式锁和Zookeeper分布式锁是如何设计的，两者有什么区别？**

  在redis里创建一个key来加锁  set my:lock 随机值 NX PX 30000   NX表示只有key不存在才设置成功，PX表示超过多久时间超时，自动释放锁，通过删除key释放锁，一般可以用lua脚本执行，判断value一样才可删除

  Zookeeper通过创建临时节点，创建成功则获取锁，创建失败，则会创建一个监听器，监听临时节点什么时候被删除，如果被删除则其他客户端重新去创建临时节点，尝试获取锁

  Zookeeper性能开销小，通过注册监听器，不需要主动去获取锁，redis需要自己不断的去尝试获取锁，比较消耗性能

- **分布式事务有了解过吗，项目中有没有使用？**

  二阶段提交，先询问，然后再处理；由一个事务管理器来管理多个事务

  TCC，try，confirm，cancel，严格的一致性事务，用在金钱交易上；对资源锁定，然后提交，如果其中有一个失败了，则会回滚操作进行补偿。强一致性事务

  本地消息表，

  可靠消息最终一致性

  最大努力通知

- **集群部署的分布式session如何实现？**



- **如何设计一个高并发的系统架构？**

系统拆分，缓存，MQ，分库分表，读写分离，es

- **如何设计一个高可用的系统架构？**

容错，降级，限流